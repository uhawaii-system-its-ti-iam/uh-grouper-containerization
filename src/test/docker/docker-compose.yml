version: "3.7"

services:
  db:
    image: mariadb:10.4.12-bionic
    environment:
      MYSQL_RANDOM_ROOT_PASSWORD: "yes"
      MYSQL_USER: grouper
      MYSQL_PASSWORD: grouper
      MYSQL_DATABASE: grouper
    command: ["--character-set-server=utf8", "--collation-server=utf8_bin"]
    ports:
      - "3306:3306"
  init:
    image: scalding/grouper-abused:2.5.22
    command: ["-registry", "-check", "-runscript", "-noprompt"]
    environment:
      JDBC_URL: jdbc:mysql://db:3306/grouper
      JDBC_USERNAME: grouper
      JDBC_PASSWORD: grouper
    secrets:
      - morphString.properties
  ui:
    image: scalding/grouper-abused-ui-pac4j
    environment:
      JDBC_URL: jdbc:mysql://db:3306/grouper
      JDBC_USERNAME: grouper
      JDBC_PASSWORD: grouper
      GROUPER_UI: "true"
      UI_BASIC_AUTHN: "false"
      JAVA_OPTS: "-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005"
    ports:
      - "8080:8080"
      - "5005:5005"
    secrets:
      - morphString.properties
      - pac4j.properties
secrets:
  morphString.properties:
    file: morphString.properties
  pac4j.properties:
    file: pac4j.properties